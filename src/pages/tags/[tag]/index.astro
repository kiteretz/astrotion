---
import Pagination from "../../../components/Pagination.astro";
import PostList from "../../../components/PostList.astro";
import config from "../../../config";
import Layout from "../../../layouts/Layout.astro";
import { client } from "../../../lib";

export async function getStaticPaths() {
  const tags = await client.getAllTags();
  return Array.from(tags).map((tag) => ({
    params: { tag },
  }));
}

const { tag } = Astro.params;
const { database, pageCount, pageInt, posts } = await client.listPosts(
  "1",
  (post) => post.tags.some((t) => t.name === tag)
);
---

<Layout rssUrl=`/tags/${tag}/rss.xml`>
  <main class="py-12 lg:py-20">
    <article class="mx-auto max-w-6xl px-3">
      <header class="mb-12 text-center">
        <h1 class:list={["mb-12 text-6xl title", config.index?.titleClasses]}>
          {database.title}
        </h1>
        <p class="mx-auto max-w-xl">
          {tag}
        </p>
      </header>
      <PostList posts={posts} />
      <Pagination page={pageInt} pageCount={pageCount} base={`/tag/${tag}`} />
    </article>
  </main>
</Layout>
<style
  define:vars={{
    titleFontFamily: config.index?.titleFontFamily || "inherit",
  }}
>
  .title {
    font-family: var(--titleFontFamily);
  }
</style>
